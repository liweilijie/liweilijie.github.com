%toc strncpy有使用时coredumps
%title strncpy有使用时coredumps
%template c

==== 1.概述 ====
今天一实习的研究生问到 *strncpy()* 最后一个参数是否必须是个数字。如果是个变量是不是会出错？

我当时没反应过来，后来到他那儿看了一下程序。才发现是这样的：

读文件夹下的所有文件，将其中的一些文件过滤出来，对其文件名称做字符串的解析等。

在使用时，他忽略了读文件夹时会读到当前目录与上级目录，也就是 *"."* 与 *".."*.

而他依旧照旧读出来进行处理。

`strncpy(data, tt+20, strlen(tt)-30);`

你会发现在 *tt* 之中长度只有 *1* ,而 *"strlen(tt)-30"* 结果就为负数，这个时候由于 *strncpy()* 对最后传入的参数没有做检查，程序就会 *coredumps* 了。

==== 2.一言概之 ====

*在strncpy()之中如果最后一个值为负数，则会出错。这是strncpy()的一个bug吧。*


