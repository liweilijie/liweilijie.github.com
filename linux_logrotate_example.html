<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>liwei.tk</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="李伟">
		<meta name="author" content="李伟的维基">

		<!-- Le styles -->
		<link href="assets/css/bootstrap.css" rel="stylesheet">
		<link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
		<!-- display by liw for the padding at the top <link href="assets/css/docs.css" rel="stylesheet">-->
		<link href="assets/css/docs.css" rel="stylesheet">
		<link href="assets/js/google-code-prettify/prettify.css" rel="stylesheet">

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<!-- Le fav and touch icons -->
		<link rel="shortcut icon" href="../assets/ico/favicon.ico">
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
		<link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
		
		<link type="text/css" rel="stylesheet" href="syntaxhighlighter/css/shCore.css" /> 
		<link type="text/css" rel="stylesheet" href="syntaxhighlighter/css/shThemeRDark.css" /> 
		<script type="text/javascript" src="syntaxhighlighter/js/shCore.js"></script> 
		<script type="text/javascript" src="syntaxhighlighter/js/shBrushPython.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/js/shBrushBash.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/js/shBrushCpp.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/js/shBrushPowerShell.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/js/shBrushXml.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/js/shBrushPlain.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/js/shBrushSql.js"></script>
		<script type="text/javascript">
			SyntaxHighlighter.defaults['gutter'] = true;
			SyntaxHighlighter.all();
			</script> 
			
		<!-- add the google analytics -->
		<script type="text/javascript">

			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-25233855-1']);
			_gaq.push(['_trackPageview']);

			(function() {
			 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			 })();

		 </script>

	</head>

	<body data-spy="scroll" data-target=".subnav" data-offset="50">

		<!-- <div class="span10 well pricehover">-->

		<!-- ==================== start navbar ================== -->
			<div class="navbar">
				<div class="navbar-inner">
					<div class="container-fuid">
					<!-- old is : <div class="container"> and fixed by to 'fuid style' -->
						<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</a>
						<a class="brand" href="#">Liwei.tk</a>
						<div class="nav-collapse">
							<ul class="nav">
								<li class="active"><a href="index.html">Home</a></li>
								<!-- Program sub projects  -->
								<li class="dropdown">
								<a href="index.html#" class="dropdown-toggle" data-toggle="dropdown">Programs <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="c.html">C</a></li>
									<li><a href="cpp.html">Cpp</a></li>
									<li><a href="shell.html">Shell</a></li>
									<li class="divider"></li>
									<li class="nav-header">Others</li>
									<li><a href="python.html">Python</a></li>
									<li><a href="expect.html">Expect</a></li>
									<li><a href="vc.html">Vc</a></li>
								</ul>
								</li>
								<!-- Os sub projects  -->
								<li class="dropdown">
								<a href="index.html#" class="dropdown-toggle" data-toggle="dropdown">Os <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="linux.html">Linux</a></li>
									<li class="divider"></li>
									<li><a href="windows.html">Windows</a></li>
								</ul>
								</li>

								<!-- vim -->
								<li><a href="vim.html">Vim</a></li>
								<li><a href="#">Link</a></li>
								<li><a href="#">Link</a></li>
								<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="#">Action</a></li>
									<li><a href="#">Another action</a></li>
									<li><a href="#">Something else here</a></li>
									<li class="divider"></li>
									<li class="nav-header">Nav header</li>
									<li><a href="#">Separated link</a></li>
									<li><a href="#">One more separated link</a></li>
								</ul>
								</li>
							</ul>
							<form class="navbar-search pull-left" action="">
								<input type="text" class="search-query span2" placeholder="Search">
							</form>
							<ul class="nav pull-right">
								<li><a href="#">Link</a></li>
								<li class="divider-vertical"></li>
								<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">随记<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="article_by_my_heart.html">随心所欲</a></li>
									<li><a href="article_reading_notes.html">读书札记</a></li>
									<li><a href="article_love_music.html">最爱音乐</a></li>
									<li class="divider"></li>
									<li><a href="#">日记</a></li>
								</ul>
								</li>
							</ul>
						</div><!-- /.nav-collapse -->
					</div>
				</div><!-- /navbar-inner -->
			</div><!-- /navbar -->
		<!--</div>-->

	<div class="container">

		<!--span2 + span10 that's really content-->
		<div class="row">
			<div class="span10" data-spy="scroll" >
				<div class="gsearch"></div>
				<div class="content">
					
<h1>logrotate</h1>
<div class="toc">
<ul>
<li><a href="#toc_0.1">1. quote</a>
<li><a href="#toc_0.2">2. logrotate配置</a>
<li><a href="#toc_0.3">3. 缺省配置 logrotate</a>
<li><a href="#toc_0.4">4. 使用include 选项读取其他配置文件</a>
<li><a href="#toc_0.5">5. 使用include 选项覆盖缺省配置</a>
<li><a href="#toc_0.6">6. 为指定的文件配置转储参数</a>
<li><a href="#toc_0.7">7. 其他需要注意的问题</a>
<li><a href="#toc_0.8">8. cron</a>
</ul>
</ul>
</div>


<h2 id="toc_0.1">1. quote</h2>

<ul>
<li>
<a href="http://www.debian-administration.org/articles/117">from debian</a>

<li>
<a href="http://en.gentoo-wiki.com/wiki/Logrotate">from wiki</a>

</ul>

<p>
Many of the services installed on Linux machines will produce logfiles which grow, and grow, and grow. 
</p>

<p>
If left unchecked you can easily fill a disk with a large collection of logfiles if you're not careful.
</p>

<p>
The most common method of keeping logfile growth in check is to use logrotate, and many Debian packages are setup to work with this by default.
</p>

<p>
The most obvious package which uses it is Apache, the webserver, which by default keeps its logfiles in the directory /var/log/apache (or /var/log/apache2).
</p>

<p>
If you examine this directory you will see that there are a bunch of logfiles which are archived:
</p>

<pre class="brush:bash;">
root@mystery:~# ls -1 /var/log/apache2/
access.log
access.log.1
access.log.2.gz
access.log.3.gz
access.log.4.gz
access.log.5.gz
error.log
error.log.1
error.log.2.gz
error.log.3.gz
error.log.4.gz
error.log.5.gz
</pre>

<p>
Here the current logfiles access.log, error.log are kept raw as are yesterday's logfiles (access.log.1 and error.log.1). 
</p>

<p>
Previous logfiles are compressed with gzip and only kept for five weeks. (I know it's five weeks and not five days because I've looked at the configuration - It's not clear from this output though!)
</p>

<p>
The process that is in charge of compressing and rotating these logfiles is called logrotate and it is executed once per day upon Debian installations.
</p>

<p>
As we saw when we were looking at scheduling commands with <strong>cron</strong> there is a directory called  <strong>/etc/cron.daily</strong> which contains scripts which are executed <strong>once per day</strong>. Here you will find the logrotate driver script.
</p>

<p>
Every day this script runs and examines two things:
</p>

<ol>
<li>
The configuration file <strong>/etc/logrotate.conf</strong>

<li>
The configuration directory  <strong>/etc/logrotate.d</strong>

</ol>

<p>
The latter is where most of our packages are configured. This directory contains configuration files which other packages have installed. For example if you install apache the file <strong>/etc/logrotate.d/apache</strong> will be installed.
</p>

<p>
Many servers such as exim the mailserver will install their own configuration file, and you can add your own.
</p>

<p>
A typical logrotate configuration file looks like this:
</p>

<pre class="brush:bash;">
/var/log/apache/*.log {
        weekly
        missingok
        rotate 52
        compress
        delaycompress
        notifempty
        create 640 root adm
        sharedscripts
        postrotate
                if [ -f /var/run/apache.pid ]; then
                        /etc/init.d/apache restart &gt; /dev/null
                fi
        endscript
}
</pre>

<pre class="brush:plain;">
/var/log/messages {
    rotate 7
    weekly
    compress
    size 50M
    notifempty
    delaycompress
    sharedscripts
    postrotate
        /etc/init.d/syslog-ng reload &gt; /dev/null 2&gt;&amp;1 || true
    endscript
}
</pre>

<p>
You can see several important things here. The most obvious is the list of files that will be matched by this configuration file:
</p>

<pre class="brush:bash;">
/var/log/apache/*.log {
...
}
</pre>

<p>
After this we have a collection of configuration terms, a different one on each line. In the example above we have:
</p>

<ul>
<li>
daily, weekly, monthly

<ul>
<li>
how often should logs be rotated. The files should be rotated every day, week, month. Opposite: ***

</ul>
<li>
rotate number

<ul>
<li>
We should keep no more than number files.

</ul>
<li>
size	

<ul>
<li>
size[G|M|k] rotate, if log-file size exceeds size bytes /kilobyts /megabyte /gigabytes 

</ul>
<li>
mail address

<ul>
<li>
mail rotated logs to specified address. 

</ul>
<li>
olddir directory

<ul>
<li>
move rotated logs to the specified directory. 

</ul>
<li>
compress

<ul>
<li>
Compress older files with gzip. Opposite: nocompress

</ul>
<li>
delaycompress

<ul>
<li>
Don't compress yesterdays files. Opposite: compress

</ul>
<li>
notifempty

<ul>
<li>
Don't do any rotation if the logfile is empty. Opposite: ifempty

</ul>
<li>
create mode owner group

<ul>
<li>
specify permissions (as in chmod) and ownership for created logs If we have to create the new file give it the given mode, owner, and group.

</ul>
<li>
sharedscripts

<ul>
<li>
Run any given prerotate or postrotate script for each logfile individually. Opposite: nosharedscripts.

</ul>
<li>
postrotate + endscript

<ul>
<li>
Anything between these is executed after the rotation process. Opposite : prerotate

</ul>
</ul>

<p>
Hopefully that should have made sense!
</p>

<p>
The upshot of this script is that any file which matches /var/log/apache/*.log is rotated every week, compressed, if it's non-empty. The new file is created with the file mode of 640, and after the rotation has finished the server is restarted.
</p>

<p>
If we wish to install a local service which creates a logfile we can cause it to be rotated very easily, just by adding a new logrotate configuration file.
</p>

<p>
Assuming we have a new service "fred" which produces its output in /var/log/fred/output.log we can cause this to be rotated every day with a script like this:
</p>

<pre class="brush:bash;">
/var/log/fred/*.log {
  daily
  missingok
  rotate 7
  compress
  delaycompress
  create 640 fred fred
  sharedscripts
     /etc/init.d/fred restart
  endscript
}
</pre>

<p>
This will:
</p>

<ul>
<li>
Run daily.

<li>
Keep no more than 7 days worth of logfiles at any one time.

<li>
Not complain if there is a logfile missing.

<li>
Compress the older files, but not yesterdays.

<li>
Create the new logfiles as being owned by the user and group fred.

<li>
Restart the service after rotating the logfiles.

</ul>

<p>
Any of the existing files in the logrotate directory can be examined for more examples - and the manpage documents all the options you may use in a clear manner:
</p>

<p>
<code>man logrotate</code> <code>logratate -f xxxxxx</code>
</p>

<h2 id="toc_0.2">2. logrotate配置</h2>

<p>
   <strong>logrotate</strong> 程序是一个日志文件管理工具。用来把旧的日志文件删除，并创建新的日志文件，我们把它叫做“转储”。
   我们可以根据日志文件的大小，也可以根据其天数来转储，这个过程一般通过  <strong>cron</strong> 程序来执行。
   <strong>logrotate</strong> 程序还可以用于压缩日志文件，以及发送日志到指定的 <strong>E-mail</strong> 。
</p>

<p>
   <strong>logrotate</strong> 的配置文件是 <code>/etc/logrotate.conf</code>  主要参数如下表：
</p>


<table class='center'>
<tr>
<th>
参数
</th>
<th>
功能
</th>
</tr>
<tr>
<td>
compress
</td>
<td>
通过gzip 压缩转储以后的日志
</td>
</tr>
<tr>
<td>
nocompress
</td>
<td>
不需要压缩时，用这个参数
</td>
</tr>
<tr>
<td>
copytruncate
</td>
<td>
用于还在打开中的日志文件，把当前日志备份并截断
</td>
</tr>
<tr>
<td>
nocopytruncate
</td>
<td>
备份日志文件但是不截断
</td>
</tr>
<tr>
<td>
create mode owner group
</td>
<td>
转储文件，使用指定的文件模式创建新的日志文件
</td>
</tr>
<tr>
<td>
nocreate
</td>
<td>
不建立新的日志文件
</td>
</tr>
<tr>
<td>
delaycompress
</td>
<td>
delaycompress 和 compress 一起使用时，转储的日志文件到下一次转储时才压缩
</td>
</tr>
<tr>
<td>
nodelaycompress
</td>
<td>
覆盖 delaycompress 选项，转储同时压缩。
</td>
</tr>
<tr>
<td>
errors address
</td>
<td>
专储时的错误信息发送到指定的Email 地址
</td>
</tr>
<tr>
<td>
ifempty
</td>
<td>
即使是空文件也转储，这个是 logrotate 的缺省选项。
</td>
</tr>
<tr>
<td>
notifempty
</td>
<td>
如果是空文件的话，不转储
</td>
</tr>
<tr>
<td>
mail address
</td>
<td>
把转储的日志文件发送到指定的E-mail 地址
</td>
</tr>
<tr>
<td>
nomail
</td>
<td>
转储时不发送日志文件
</td>
</tr>
<tr>
<td>
olddir directory
</td>
<td>
转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统
</td>
</tr>
<tr>
<td>
noolddir
</td>
<td>
转储后的日志文件和当前日志文件放在同一个目录下
</td>
</tr>
<tr>
<td>
prerotate/endscript
</td>
<td>
在转储以前需要执行的命令可以放入这个对，这两个关键字必须单独成行
</td>
</tr>
<tr>
<td>
postrotate/endscript
</td>
<td>
在转储以后需要执行的命令可以放入这个对，这两个关键字必须单独成行
</td>
</tr>
<tr>
<td>
daily
</td>
<td>
指定转储周期为每天
</td>
</tr>
<tr>
<td>
weekly
</td>
<td>
指定转储周期为每周
</td>
</tr>
<tr>
<td>
monthly
</td>
<td>
指定转储周期为每月
</td>
</tr>
<tr>
<td>
rotate count
</td>
<td>
指定日志文件删除之前转储的次数，0 指没有备份，5 指保留5 个备份
</td>
</tr>
<tr>
<td>
tabootext [+] list
</td>
<td>
让logrotate 不转储指定扩展名的文件，缺省的扩展名是：.rpm-orig, .rpmsave, v, 和 ~
</td>
</tr>
<tr>
<td>
size size
</td>
<td>
当日志文件到达指定的大小时才转储，Size 可以指定 bytes (缺省)以及KB (sizek)或者MB (sizem).
</td>
</tr>
</table>

<h2 id="toc_0.3">3. 缺省配置 logrotate</h2>

<p>
   <strong>logrotate</strong> 缺省的配置文件是 <strong>/etc/logrotate.conf</strong>
</p>
   
<p>
   Red Hat Linux 缺省安装的文件内容是：
</p>

<pre class="brush:plain;">
   # see "man logrotate" for details
   # rotate log files weekly
   weekly # 指定所有的日志文件每周转储一次。

   # keep 4 weeks worth of backlogs
   rotate 4 # 指定转储文件的保留 4份。

   # send errors to root
   errors root # 指定错误信息发送给root。
   # create new (empty) log files after rotating old ones
   create # 指定 logrotate 自动建立新的日志文件，新的日志文件具有和原来的文件一样的权限。

   # uncomment this if you want your log files compressed
   #compress #compress 指定不压缩转储文件，如果需要压缩，去掉注释就可以了。
   1
   # RPM packages drop log rotation information into this directory
   include /etc/logrotate.d

   # no packages own lastlog or wtmp --we'll rotate them here
   /var/log/wtmp {
   monthly
   create 0664 root utmp
   rotate 1
   }

   /var/log/lastlog {
   monthly
   rotate 1
   }

   # system-specific logs may be configured here
</pre>

<h2 id="toc_0.4">4. 使用include 选项读取其他配置文件</h2>

<p>
   <strong>include</strong> 选项允许系统管理员把分散到几个文件的转储信息，集中到一个主要的配置文件。
</p>
   
<p>
   当 <strong>logrotate</strong> 从 <strong>logrotate.conf</strong> 读到 <strong>include</strong> 选项时，会从指定文件读入配置信息，就好像他们已经在 <strong>/etc/logrotate.conf</strong> 中一样。
</p>

<p>
   第13行 include /etc/logrotate.d 告诉 logrotate 读入存放在/etc/logrotate.d 目录中的日志转储参数，当系统中安装了RPM 软件包时，使用include 选项十分有用。RPM 软件包的日志转储参数一般存放在/etc/logrotate.d 目录。
</p>

<p>
   <strong>include</strong> 选项十分重要，一些应用把日志转储参数存放在 <strong>/etc/logrotate.d</strong> 。
</p>

<p>
   典型的应用有：apache, linuxconf, samba, cron 以及syslog。
</p>

<p>
   这样，系统管理员只要管理一个 <strong>/etc/logrotate.conf</strong> 文件就可以了。
</p>

<h2 id="toc_0.5">5. 使用include 选项覆盖缺省配置</h2>

<p>
   当 <strong>/etc/logrotate.conf</strong> 读入文件时， <strong>include</strong> 指定的文件中的转储参数将覆盖缺省的参数，如下例：
</p>

<pre class="brush:bash;">
   # linuxconf 的参数
   /var/log/htmlaccess.log
   {
   errors jim
   notifempty
   nocompress
   weekly
   prerotate
     /usr/bin/chattr -a /var/log/htmlaccess.log
   endscript
   postrotate
     /usr/bin/chattr +a /var/log/htmlaccess.log
   endscript
   }
   /var/log/netconf.log
   {
   nocompress
   monthly
   }
</pre>
 
<p>
   在这个例子中，当 <strong>/etc/logrotate.d/linuxconf</strong> 文件被读入时，下面的参数将覆盖 <strong>/etc/logrotate.conf</strong> 中缺省的参数。
</p>
   
<p>
   <code>Notifempty</code>
</p>
   
<p>
   <code>errors jim</code>
</p>

<h2 id="toc_0.6">6. 为指定的文件配置转储参数</h2>

<p>
   经常需要为指定文件配置参数，一个常见的例子就是每月转储 <strong>/var/log/wtmp</strong> 。为特定文件而使用的参数格式是：
</p>

<pre class="brush:bash;">
   # 注释
   /full/path/to/file
   {
   option(s)
   }
</pre>

<p>
下面的例子就是每月转储 <strong>/var/log/wtmp</strong> 一次：
</p>

<pre class="brush:bash;">
   #Use logrotate to rotate wtmp
   /var/log/wtmp
   {
   monthly
   rotate 1
   }
</pre>
 

<h2 id="toc_0.7">7. 其他需要注意的问题</h2>

<ul>
<li>
尽管花括号的开头可以和其他文本放在同一行上，但是结尾的花括号必须单独成行。

<li>
使用 <strong>prerotate</strong> 和 <strong>postrotate</strong> 选项

</ul>
   
<p>
	 下面的例子是典型的脚本 <strong>/etc/logrotate.d/syslog</strong> ，这个脚本只是对 <strong>/var/log/messages</strong> 有效。
</p>

<pre class="brush:bash;">
   /var/log/messages
   { 
   prerotate
	 /usr/bin/chattr -a /var/log/messages
   endscript
   postrotate
	 /usr/bin/kill -HUP syslogd
	 /usr/bin/chattr +a /var/log/messages
   endscript
   }
</pre>
 
<ul>
<li>
第一行指定脚本对 /var/log/messages 有效

<li>
<code>prerotate</code> 命令指定转储以前的动作 <strong>/usr/bin/chattr -a</strong> 去掉 <strong>/var/log/messages</strong> 文件的“只追加”属性 

<li>
<code>endscript</code> 结束

<li>
<code>postrotate</code> 指定转储后的动作

<li>
<code>/usr/bin/killall -HUP syslogd</code> 用来重新初始化系统日志守护程序 syslogd

<li>
<code>/usr/bin/chattr +a /var/log/messages</code> 重新为 /var/log/messages 文件指定“只追加”属性，这样防治程序员或用户覆盖此文件。

<li>
最后的 <code>endscript</code> 用于结束 postrotate 部分的脚本

</ul>

<ul>
<li>
<strong>logrotate</strong> 的运行分为三步： 判断系统的日志文件，建立转储计划以及参数，通过 <strong>cron daemon</strong> 运行下面的代码是 Red Hat Linux 缺省的crontab 来每天运行logrotate。

</ul>

<pre class="brush:bash;">
   #/etc/cron.daily/logrotate
   #! /bin/sh

   /usr/sbin/logrotate /etc/logrotate.conf
</pre>
 

<ul>
<li>
/var/log/messages 不能产生的原因： 这种情况很少见，但是如果你把/etc/services 中的 514/UDP 端口关掉的话，这个文件就不能产生了。

</ul>

<h2 id="toc_0.8">8. cron</h2>

<p>
   <strong>cron</strong> 是一个可以用来根据时间、日期、月份、星期的组合来调度对重复任务的执行的守护进程。
</p>

<p>
   <strong>cron</strong> 假定系统持续运行。如果当某任务被调度时系统不在运行，该任务就不会被执行。 
</p>
   
<p>
   要使用 cron 服务，你必须安装了 vixie-cron RPM 软件包，而且必须在运行 crond 服务。要判定该软件包是否已安装，使用 rpm -q vixie-cron 命令。要判定该服务是否在运行，使用 /sbin/service crond status 命令。
</p>

<ul>
<li>
配置 cron 任务

<li>
cron 的主配置文件是 <strong>/etc/crontab</strong> ，它包括下面几行：

</ul>

<pre class="brush:bash;">
   SHELL=/bin/bash
   PATH=/sbin:/bin:/usr/sbin:/usr/bin
   MAILTO=root
   HOME=/

   # run-parts
   01 * * * * root run-parts /etc/cron.hourly
   02 4 * * * root run-parts /etc/cron.daily
   22 4 * * 0 root run-parts /etc/cron.weekly
   42 4 1 * * root run-parts /etc/cron.monthly 
</pre>
 

<ul>
<li>
前四行是用来配置 cron 任务运行环境的变量。SHELL 变量的值告诉系统要使用哪个 shell 环境（在这个例子里是 bash shell）；PATH 变量定义用来执行命令的路径。cron 任务的输出被邮寄给 MAILTO 变量定义的用户名。如果 MAILTO 变量被定义为空白字符串（MAILTO=""），电子邮件就不会被寄出。HOME 变量可以用来设置在执行命令或脚本时使用的主目录。

<li>
<strong>/etc/crontab</strong> 文件中的每一行都代表一项任务，它的格式是： <code>minute   hour   day   month   dayofweek   command</code>

<ul>
<li>
<code>minute</code> — 分钟，从 0 到 59 之间的任何整数

<li>
<code>hour</code> — 小时，从 0 到 23 之间的任何整数

<li>
<code>day</code> — 日期，从 1 到 31 之间的任何整数（如果指定了月份，必须是该月份的有效日期）

<li>
<code>month</code> — 月份，从 1 到 12 之间的任何整数（或使用月份的英文简写如 jan、feb 等等）

<li>
<code>dayofweek</code> — 星期，从 0 到 7 之间的任何整数，这里的 0 或 7 代表星期日（或使用星期的英文简写如 sun、mon 等等）

<li>
<code>command</code> — 要执行的命令（命令可以是 ls /proc &gt;&gt; /tmp/proc 之类的命令，也可以是执行你自行编写的脚本的命令。）

<li>
在以上任何值中，星号（*）可以用来代表所有有效的值。譬如，月份值中的星号意味着在满足其它制约条件后每月都执行该命令。 

<li>
整数间的短线（-）指定一个整数范围。譬如，1-4 意味着整数 1、2、3、4。 

<li>
用逗号（,）隔开的一系列值指定一个列表。譬如，3, 4, 6, 8 标明这四个指定的整数。 

<li>
正斜线（/）可以用来指定间隔频率。在范围后加上 /&lt;integer&gt; 意味着在范围内可以跳过 integer。譬如，0-59/2 可以用来在分钟字段定义每两分钟。间隔频率值还可以和星号一起使用。例如，*/3 的值可以用在月份字段中表示每三个月运行一次任务。 

<li>
开头为井号（#）的行是注释，不会被处理。

<li>
如你在 /etc/crontab 文件中所见，它使用 run-parts 脚本来执行i <code>/etc/cron.hourly</code>、<code>/etc/cron.daily</code>、<code>/etc/cron.weekly</code> 和 <code>/etc/cron.monthly</code> 目录中的脚本，这些脚本被相应地每小时、每日、每周、或每月执行。这些目录中的文件应该是 shell 脚本。

</ul>
</ul>

<ul>
<li>
如果某 cron 任务需要根据调度来执行，而不是每小时、每日、每周、或每月地执行，它可以被添加到 /etc/cron.d 目录中。该目录中的所有文件使用和 /etc/crontab 中一样的语法。范例请参见下例。
<pre class="brush:bash;">
   # record the memory usage of the system every monday 
   # at 3:30AM in the file /tmp/meminfo
   30 3 * * mon cat /proc/meminfo &gt;&gt; /tmp/meminfo
   # run custom script the first day of every month at 4:10AM
   10 4 1 * * /root/scripts/backup.sh 
</pre>

<li>
根用户以外的用户可以使用 crontab 工具来配置 cron 任务。所有用户定义的 crontab 都被保存在 /var/spool/cron 目录中，并使用创建它们的用户身份来执行。要以某用户身份创建一个 crontab 项目，登录为该用户，然后键入 crontab -e 命令，使用由 VISUAL 或 EDITOR 环境变量指定的编辑器来编辑该用户的 crontab。该文件使用的格式和 /etc/crontab 相同。当对 crontab 所做的改变被保存后，该 crontab 文件就会根据该用户名被保存，并写入文件 /var/spool/cron/username 中。

<li>
cron 守护进程每分钟都检查 /etc/crontab 文件、etc/cron.d/ 目录、以及 /var/spool/cron 目录中的改变。如果发现了改变，它们就会被载入内存。这样，当某个 crontab 文件改变后就不必重新启动守护进程了。

<li>
控制对 cron 的使用. <code>/etc/cron.allow</code> 和 <code>/etc/cron.deny</code> 文件被用来限制对 cron 的使用。这两个使用控制文件的格式都是每行一个用户。两个文件都不允许空格。如果使用控制文件被修改了，cron 守护进程（crond）不必被重启。使用控制文件在每次用户添加或删除一项 cron 任务时都会被读取。

<ul>
<li>
无论使用控制文件中的规定如何，根用户都总是可以使用 cron。 

<li>
如果 cron.allow 文件存在，只有其中列出的用户才被允许使用 cron，并且 cron.deny 文件会被忽略。 

<li>
如果 cron.allow 文件不存在，所有在 cron.deny 中列出的用户都被禁止使用 cron。

</ul>
<li>
启动和停止服务 要启动 cron 服务，使用 /sbin/service crond start 命令。要停止该服务，使用 /sbin/service crond stop 命令。推荐你在引导时启动该服务。

</ul>

				</div>
			</div>
		</div> <!-- really content end -->
		<div class="row footer">
			<hr />
			<a href="index.html">首页</a>
			<a href="#"> | 关于</a>
			<a href="#"> | 链接</a>
			<a href="#"> | 链接</a>
		</div>

	</div>

		<!-- Le javascript ================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<!-- display by liw <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>-->
		<!--<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>-->
		<script src="assets/js/jquery.js"></script>
		<script src="assets/js/liwei.js"></script>
		<script src="assets/js/google-code-prettify/prettify.js"></script>
		<script src="assets/js/bootstrap-transition.js"></script>
		<script src="assets/js/bootstrap-alert.js"></script>
		<script src="assets/js/bootstrap-modal.js"></script>
		<script src="assets/js/bootstrap-dropdown.js"></script>
		<script src="assets/js/bootstrap-scrollspy.js"></script>
		<script src="assets/js/bootstrap-tab.js"></script>
		<script src="assets/js/bootstrap-tooltip.js"></script>
		<script src="assets/js/bootstrap-popover.js"></script>
		<script src="assets/js/bootstrap-button.js"></script>
		<script src="assets/js/bootstrap-collapse.js"></script>
		<script src="assets/js/bootstrap-carousel.js"></script>
		<script src="assets/js/bootstrap-typeahead.js"></script>
		<script src="assets/js/application.js"></script>
		<script src="assets/js/liwei.js"></script>


	</body>
</html>
